#!/bin/bash

# run `arp -a` to find the pi's mac address
readonly RASPI_MAC_ADDR="${RASPI_MAC_ADDR:?Could not find RASPI_MAC_ADDR environment variable}"

PI_IP_ADDR_LINE="$(arp -a | grep -m1 "$RASPI_MAC_ADDR")"
[[ -z "$PI_IP_ADDR_LINE" ]] && {
  printf "Couldn't find a device on the network with the mac address: %s\n" "${RASPI_MAC_ADDR}" >&2
  exit 1
}
grep -oP '\([\d\.]+\)' <<<"$PI_IP_ADDR_LINE" | tr -d '()'

